<!DOCTYPE html>
<html>
<head>
    <title>Search</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />

    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link rel="stylesheet" href="/stylesheets/bootstrap-datepicker.css">
    <link rel="stylesheet" href="/stylesheets/bootstrap-datetimepicker.css">

    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap-datepicker.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap-datetimepicker.js"></script>

    <style>
        .thumbnail {
            margin-bottom: 20px;
            padding: 0px;
            -webkit-border-radius: 0px;
            -moz-border-radius: 0px;
            border-radius: 0px;
        }

        .item.list-group-item .thumbnail {
            margin-bottom: 0px;
        }

        .item.list-group-item img {
            float: left;
        }

        .list-group-item-text {
            margin: 0 0 11px;
        }

        .list-group-item {
            height: 75%;
        }

        .box {
            width: 100%;
            height: 140px;
            background-color: #ffffff;
        }
        .box1 {
            width: 100%;
            height: 33px;
            background-color: #5483ED;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="well well-sm" style="height: 200px;">
        <strong>Category Title</strong><br/><br/>
        <form class="form-horizontal" role="form" id="register">
            <div class="form-group">
                <label for="gender1" class="col-sm-1 control-label">선거명</label>
                <div class="col-sm-2">
                    <select class="form-control" id="electionName" name="electionName">
                        <option value="">선택</option>
                        <option value="지방선거">지방선거</option>
                        <option value="총선">총선</option>
                        <option value="대선">대선</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <label for="gender1" class="col-sm-1 control-label">공개여부</label>
                <div class="col-sm-2">
                    <select class="form-control" id="visibility" name="visibility">
                        <option value="">선택</option>
                        <option value="공개">공개</option>
                        <option value="비공개">비공개</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <label for="gender1" class="col-sm-1 control-label">참석여부</label>
                <div class="col-sm-2">
                    <select class="form-control" id="attend" name="attend">
                        <option value="">선택</option>
                        <option value="참석">참석</option>
                        <option value="불참석">불참석</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <label for="email1" class="col-sm-1 control-label">지역</label>
                <div class="col-sm-2">
                    <select class="form-control" id="location" name="location">
                        <option value="">선택</option>
                        <option value="거제시">거제시</option>
                        <option value="거창군">거창군</option>
                        <option value="고성군">고성군</option>
                        <option value="김해시">김해시</option>
                        <option value="남해군">남해군</option>
                        <option value="마산시">마산시</option>
                        <option value="밀양시">밀양시</option>
                        <option value="사천시">사천시</option>
                        <option value="산청군">산청군</option>
                        <option value="양산시">양산시</option>
                        <option value="의령군">의령군</option>
                        <option value="진주시">진주시</option>
                        <option value="진해시">진해시</option>
                        <option value="창녕군">창녕군</option>
                        <option value="창원시">창원시</option>
                        <option value="통영시">통영시</option>
                        <option value="하동군">하동군</option>
                        <option value="함안군">함안군</option>
                        <option value="함양군">함양군</option>
                        <option value="합천군">합천군</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="email1" class="col-sm-1 control-label">해당자</label>
                <div class="col-sm-2">
                    <select class="form-control" id="applicant" name="applicant">
                        <option value="">선택</option>
                        <option value="후보자">후보자</option>
                        <option value="배우자">배우자</option>
                        <option value="가족">가족</option>
                        <option value="선대위원장">선대위원장</option>
                        <option value="유세팀">유세팀</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <label for="email1" class="col-sm-1 control-label">하실일</label>
                <div class="col-sm-2">
                    <select class="form-control" id="work" name="work">
                        <option value="">선택</option>
                        <option value="축사">축사</option>
                        <option value="간담회">간담회</option>
                        <option value="차담">차담</option>
                        <option value="식사">식사</option>
                        <option value="예방">예방</option>
                        <option value="참배">참배</option>
                        <option value="인터뷰">인터뷰</option>
                        <option value="유세">유세</option>
                        <option value="특강">특강</option>
                        <option value="토론회">토론회</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
                <label for="email1" class="col-sm-1 control-label">협업</label>
                <div class="col-sm-2">
                    <select class="form-control" id="cooperation" name="cooperation">
                        <option value="">선택</option>
                        <option value="메시지">메시지</option>
                        <option value="정책">정책</option>
                        <option value="홍보">홍보</option>
                        <option value="공보">공보</option>
                        <option value="조직">조직</option>
                        <option value="지역">지역</option>
                        <option value="기타">기타</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="DatePicker" class="col-sm-1 control-label">시작 시간</label>
                <div class="col-sm-2">
                    <input type="text" class="form-control" id="startDate" name="startDate" placeholder="시작시간">
                </div>
                <label for="DatePicker" class="col-sm-1 control-label">종료 시간</label>
                <div class="col-sm-2">
                    <input type="text" class="form-control" id="endDate" name="endDate" placeholder="종료시간">
                </div>
                <div class="col-sm-2">
                    <button type="button" class="btn btn-info" id="print" style="width: 100%; display: none" >출력</button>
                </div>
                <div class="col-sm-2">
                    <button type="button" class="btn btn-danger" id="reset" style="width: 100%">재설정</button>
                </div>
                <div class="col-sm-2">
                    <button type="button" class="btn btn-default" id="search" style="width: 100%">검색</button>
                </div>
            </div>
        </form>
    </div>

    <div class="list-group" id="listGroup">

      <!--  <div class="list-group-item" style="border: 0 none;">

            &lt;!&ndash; Start &ndash;&gt;
            <div>asd</div>
            <div id="products" class="row list-group">

                <div class="item  col-xs-4 col-lg-2">
                    <div class="thumbnail">
                        <div class="box">
                            <div class="caption">
                                <h4 class="group inner list-group-item-heading">
                                    Product title</h4>
                                <p class="group inner list-group-item-text">
                                    Product description... </p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            &lt;!&ndash; End &ndash;&gt;
        </div>-->

        <!--<div class="list-group-item" style="border: 0 none;">
            <div id="products" class="row list-group">

                <div class="item  col-xs-4 col-lg-2">
                    <div class="thumbnail">
                        <div class="box">
                            <div class="caption">
                                <h4 class="group inner list-group-item-heading">
                                    Product title</h4>
                                <p class="group inner list-group-item-text">
                                    Product description... </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="item  col-xs-4 col-lg-2">
                    <div class="thumbnail">
                        <div class="box">
                            <div class="caption">
                                <h4 class="group inner list-group-item-heading">
                                    Product title</h4>
                                <p class="group inner list-group-item-text">
                                    Product description... </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="item  col-xs-4 col-lg-2">
                    <div class="thumbnail">
                        <div class="box">
                            <div class="caption">
                                <h4 class="group inner list-group-item-heading">
                                    Product title</h4>
                                <p class="group inner list-group-item-text">
                                    Product description... </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="item  col-xs-4 col-lg-2">
                    <div class="thumbnail">
                        <div class="box">
                            <div class="caption">
                                <h4 class="group inner list-group-item-heading">
                                    Product title</h4>
                                <p class="group inner list-group-item-text">
                                    Product description... </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="item  col-xs-4 col-lg-2">
                    <div class="thumbnail">
                        <div class="box">
                            <div class="caption">
                                <h4 class="group inner list-group-item-heading">
                                    Product title</h4>
                                <p class="group inner list-group-item-text">
                                    Product description... </p>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="item  col-xs-4 col-lg-2">
                    <div class="thumbnail">
                        <div class="box">
                            <div class="caption">
                                <h4 class="group inner list-group-item-heading">
                                    Product title</h4>
                                <p class="group inner list-group-item-text">
                                    Product description... </p>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="item  col-xs-4 col-lg-2">
                    <div class="thumbnail">
                        <div class="box">
                            <div class="caption">
                                <h4 class="group inner list-group-item-heading">
                                    Product title</h4>
                                <p class="group inner list-group-item-text">
                                    Product description... </p>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>-->



    </div>


</div>

<!-- print Input data -->
<form method="post" action="/calendar/excel" id="printForm">
    <input type="text" id="printData" name="printData" hidden/>
</form>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" role="form" id="register" method="post" action="/calendar">
                    <div class="form-group">
                        <label for="gender1" class="col-sm-2 control-label">선거명</label>
                        <div class="col-sm-4">
                            <select class="form-control" id="MelectionName" name="electionName">
                                <option value="">선택</option>
                                <option value="지방선거">지방선거</option>
                                <option value="총선">총선</option>
                                <option value="대선">대선</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="gender1" class="col-sm-2 control-label">공개여부</label>
                        <div class="col-sm-4">
                            <select class="form-control" id="Mvisibility" name="visibility">
                                <option value="">선택</option>
                                <option value="공개">공개</option>
                                <option value="비공개">비공개</option>
                                <option value="기타">기타</option>
                            </select>

                        </div>
                    </div>
                    <div class="form-group">
                        <label for="gender1" class="col-sm-2 control-label">참석여부</label>
                        <div class="col-sm-4">
                            <select class="form-control" id="Mattend" name="attend">
                                <option value="">선택</option>
                                <option value="참석">참석</option>
                                <option value="불참석">불참석</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="name1" class="col-sm-2 control-label">행사명</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="MeventName" placeholder="Event Name" name="eventName">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="email1" class="col-sm-2 control-label">지역</label>
                        <div class="col-sm-4">
                            <select class="form-control" id="Mlocation" name="location">
                                <option value="">선택</option>
                                <option value="거제시">거제시</option>
                                <option value="거창군">거창군</option>
                                <option value="고성군">고성군</option>
                                <option value="김해시">김해시</option>
                                <option value="남해군">남해군</option>
                                <option value="마산시">마산시</option>
                                <option value="밀양시">밀양시</option>
                                <option value="사천시">사천시</option>
                                <option value="산청군">산청군</option>
                                <option value="양산시">양산시</option>
                                <option value="의령군">의령군</option>
                                <option value="진주시">진주시</option>
                                <option value="진해시">진해시</option>
                                <option value="창녕군">창녕군</option>
                                <option value="창원시">창원시</option>
                                <option value="통영시">통영시</option>
                                <option value="하동군">하동군</option>
                                <option value="함안군">함안군</option>
                                <option value="함양군">함양군</option>
                                <option value="합천군">합천군</option>
                                <option value="etc">기타</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="email1" class="col-sm-2 control-label">해당자</label>
                        <div class="col-sm-4">
                            <select class="form-control" id="Mapplicant" name="applicant">
                                <option value="">선택</option>
                                <option value="candidate">후보자</option>
                                <option value="배우자">배우자</option>
                                <option value="가족">가족</option>
                                <option value="선대위원장">선대위원장</option>
                                <option value="유세팀">유세팀</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="email1" class="col-sm-2 control-label">하실일</label>
                        <div class="col-sm-4">
                            <select class="form-control" id="Mwork" name="work">
                                <option value="">선택</option>
                                <option value="축사">축사</option>
                                <option value="간담회">간담회</option>
                                <option value="차담">차담</option>
                                <option value="식사">식사</option>
                                <option value="예방">예방</option>
                                <option value="참배">참배</option>
                                <option value="인터뷰">인터뷰</option>
                                <option value="유세">유세</option>
                                <option value="특강">특강</option>
                                <option value="토론회">토론회</option>
                                <option value="etc">기타</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="email1" class="col-sm-2 control-label">협업</label>
                        <div class="col-sm-4">
                            <select class="form-control" id="Mcooperation" name="cooperation">
                                <option value="">선택</option>
                                <option value="메시지">메시지</option>
                                <option value="정책">정책</option>
                                <option value="홍보">홍보</option>
                                <option value="공보">공보</option>
                                <option value="조직">조직</option>
                                <option value="지역">지역</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="DatePicker" class="col-sm-2 control-label">시작 시간</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="MstartDate" name="startDate" placeholder="시작시간">
                        </div>
                        <label for="DatePicker" class="col-
                        .0
                        .0sm-2 control-label">종료 시간</label>
                        <div class="col-sm-4">
                            <input type="text" class="form-control" id="MendDate" name="endDate" placeholder="종료시간">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="name1" class="col-sm-2 control-label">설명</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="Mdescription" placeholder="Description" name="description">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveCahnge">Save changes</button>
                <button type="button" class="btn btn-danger" id="calendarRemove">Delete</button>
            </div>
        </div>
    </div>
</div>

<script>

    var map = {};
    var u_id = null;
    var printData = {};

    $(document).ready(function(){

        $("#startDate, #endDate").datepicker({ format: 'yyyy-mm-dd',  autoClose : true });
        $("#MstartDate, #MendDate").datetimepicker({ format: 'yyyy-mm-dd hh:ii', autoClose: true});

        $("#reset").click(function(){

            $(".item").remove();
            $("#print").hide();

            $("#electionName option:eq(0)").prop("selected", true);
            $("#visibility option:eq(0)").prop("selected", true);
            $("#attend option:eq(0)").prop("selected", true);
            $("#location option:eq(0)").prop("selected", true);
            $("#applicant option:eq(0)").prop("selected", true);
            $("#work option:eq(0)").prop("selected", true);
            $("#cooperation option:eq(0)").prop("selected", true);

            $("#startDate").val("");
            $("#endDate").val("");

        });


        $("#calendarRemove").click(function(){

            $.ajax({
                type: "POST",
                url: "/calendar/delete",
                data: "uid="+u_id+"&sds=12345",
                //cache: false,
                success: function(data){

                    if(data == "success") {
                        $("#exampleModal").modal("hide")
                        const divId = "#"+u_id;
                        $(divId).remove();
                    } else {
                        alert("ERROR");
                    }

                },
                error : function(err) {
                    alert(JSON.stringify(err.message));
                }
            });

        });

        $("#saveCahnge").click(function(){

            const electionName = $("#MelectionName").val();
            const visibility = $("#Mvisibility").val();
            const attend = $("#Mattend").val();
            const eventName = $("#MeventName").val();
            const location = $("#Mlocation").val();
            const applicant = $('#Mapplicant').val();
            const work = $("#Mwork").val();
            const cooperation = $("#Mcooperation").val();
            const description = $("#Mdescription").val();
            const startDate = $("#MstartDate").val();
            const endDate = $("#MendDate").val();

            //console.log(electionName + " : " + visibility + " : " +attend + " : " + eventName + " : " + location)
            //console.log(applicant + " : " + work + " : " +cooperation + " : " + description + " : " + startDate + " : " + endDate);

            const object = {
                electionName : electionName,
                visibility : visibility,
                attend : attend,
                eventName : eventName,
                location : location,
                applicant : applicant,
                work : work,
                cooperation : cooperation,
                description : description,
                startDate : startDate,
                endDate : endDate,
                calendarId : u_id
            }

            $.ajax({
                type: "POST",
                url: "/calendar/update",
                dataType: "json",
                data: "result="+JSON.stringify(object),
                //cache: false,
                success: function(data){

                    if(data == "success") {
                        $("#exampleModal").modal("hide")
                    } else {
                        alert("ERROR");
                    }

                },
                error : function(err) {
                    alert(JSON.stringify(err.message));
                }
            });

        });

        $(document).on("click", ".box", function() {

            const uid = $(this).children(".caption").children(".uid").val();

            const thisData = map[uid].extendedProperties.private;
            u_id = uid;

            console.log(thisData);

            $("#MelectionName option[value="+thisData.electionName+"]").attr("selected", "selected");
            $("#Mvisibility option[value="+thisData.visibility+"]").attr("selected", "selected");
            $("#Mattend option[value="+thisData.attend+"]").attr("selected", "selected");
            $("#MeventName").val(""+thisData.eventName+"");

            $("#Mlocation option[value="+thisData.location+"]").attr("selected", "selected");
            $("#Mapplicant option[value="+thisData.applicant+"]").attr("selected", "selected");
            $("#Mwork option[value="+thisData.work+"]").attr("selected", "selected");

            $("#Mcooperation option[value="+thisData.cooperation+"]").attr("selected", "selected");
            $("#Mdescription").val(""+thisData.description+"");
            $("#MstartDate").val(""+thisData.startDate+"");
            $("#MendDate").val(""+thisData.endDate+"");

            $("#exampleModal").modal("show")

        })

        $(document).on("click", ".box1", function() {

            const uid = $(this).children(".uid").val();
            const thisData = map[uid].extendedProperties.private;

            const cssCheck = $(this).parents(".thumbnail").css("outline-style");

            console.log("color : " + $(this).parents(".thumbnail").css("outline-color"))

            if(cssCheck == "none") {
                $(this).parents(".thumbnail").css({'outline': '5px solid blue'});
                printData[uid] = thisData;
            } else {
                $(this).parents(".thumbnail").css({'outline': 'none'});
                delete printData[uid];
            }

            if(Object.keys(printData).length == 0) {
                $("#print").hide();
            } else {
                $("#print").show();

            }

            $("#printData").val(JSON.stringify(printData));

            //console.log(printData);

        })

        $("#print").click(function(){

            const length = Object.keys(printData).length;

            if(length == 0) {
                alert("Please, Choose Data");
                return;
            }

            const jsonData = JSON.parse($("#printData").val());

            var sort = [];

            for(var index in jsonData) {
                const obj = {
                    index: index,
                    time: jsonData[index].startDate
                }
                sort.push(obj);
            }

            sort.sort(function(a, b) {
                return new Date(a.time) - new Date(b.time);
            });

            var tempObk = {};

            for(var i=0; i<sort.length; i++) {
                const key = sort[i].index;
                tempObk[key] = printData[key];
            }

            $("#printData").val(JSON.stringify(tempObk));

            $("#printForm").submit();

        });

        $("#search").click(function(){

            $(".item").remove();

            var list = {};

            const electionName = $("#electionName").val();
            const visibility = $("#visibility").val();
            const attend = $("#attend").val();
            const location = $("#location").val();
            const applicant = $("#applicant").val();
            const work = $("#work").val();
            const cooperation = $("#cooperation").val();

            const startDate = $("#startDate").val();
            const endDate = $("#endDate").val();

            if(electionName != "") { list["electionName"] = electionName; }
            if(visibility != "") { list["visibility"] = visibility; }
            if(attend != "") { list["attend"] = attend; }
            if(location != "") { list["location"] = location; }
            if(applicant != "") { list["applicant"] = applicant; }
            if(work != "") { list["work"] = work; }
            if(cooperation != "") { list["cooperation"] = cooperation; }


            console.log("startDate="+startDate+"&endDate="+endDate);

            $.ajax({
                type: "GET",
                url: "/calendar/search/list",
                data: "startDate="+startDate+"&endDate="+endDate,
                cache: false,
                success: function(data){

                    var otherDate = "";

                    for(var i=0; i<data.length; i++) {
                        //console.log(data[i]);
                        const json = data[i];

                        const title = json.summary;
                        const location = json.location;
                        const desc = json.description;


                        const id = json.id;

                        // insert Hashmap
                        map[json.id] = json;

                        //console.log(JSON.stringify(json));

                        const extension = json.extendedProperties.private;
                        const register = extension.register;

                        var boxVisible = true;

                        for(var key in list) {
                            console.log(list[key] + " - " + extension[key]);
                            if(list[key].toString() != extension[key].toString()) {
                                boxVisible = false;
                                break;
                            }
                        }

                        if(boxVisible) {

                            const split = extension.startDate.split(" ");
                            const endSplit = extension.endDate.split(" ");
                            //console.log(otherDate[0] + " : " + split[0]);
                            if(otherDate != split[0]) {
                                console.log("wrong");
                                $("#listGroup").append('<div class="list-group-item" style="border: 0 none;">' +
                                    '<div><h3>'+split[0]+'</h3></div><div id="'+split[0]+'" class="row list-group"></div></div>')

                                otherDate = split[0];

                            }

                            $("#"+split[0]+"").append(
                                "<div class='item  col-xs-3 col-lg-2' id='"+id+"' >" +
                                "           <div class='thumbnail' style='outline: none'>" +
                                "               <div class=\"box\">" +
                                "                   <div class=\"caption\">" +
                                "                        <input type='hidden'value='"+id+"' class='uid'>" +
                                "                        <h4 class='group inner list-group-item-heading' style='text-overflow: ellipsis; overflow: hidden; white-space: nowrap; width: 150px;'>"+title+"</h4>" +
                                "                        <p class='group inner list-group-item-text' style='text-overflow: ellipsis; overflow: hidden; white-space: nowrap; width: 150px;'>"+desc+"</p>" +
                                "                        "+location+"<br/>" +
                                "                        시작시간:"+split[1]+"<br/>" +
                                "                        종료시간:"+endSplit[1]+"<br/>" +
                                "                        <p class=\"group inner list-group-item-text\">"+register+"</p>" +
                                "                   </div>" +
                                "               </div>" +
                                "               <div class='box1' style='outline: none'>" +
                                "                        <input type='hidden'value='"+id+"' class='uid'>" +
                                "               </div>" +
                                "            </div>" +
                                "</div>");
                        }

                    }

                },
                error : function(err) {
                    alert(JSON.stringify(err.message));
                }
            });

        });

    });
</script>
</body>
</html>